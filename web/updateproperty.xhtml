<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <f:metadata>
        <f:viewParam name="id" value="#{propertyUserBean.id}" />
        <f:viewAction action="#{propertyUserBean.init}" />
    </f:metadata>
    <body>

        <ui:composition template="./view/TemplateUser.xhtml">

            <ui:define name="script">
                <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"/>
                <h:outputScript name="./js/gmap.js"/>
            </ui:define>
            <ui:define name="title">
                Update property
            </ui:define>



            <ui:define name="content">
                <div style="padding: 10px">
                    <div class="bold-title">
                        UPDATE A PROPERTY
                    </div>
                    <h:form id="frm" enctype="multipart/form-data"  >
                        <p:growl id="msgs"  autoUpdate="true" />
                        <p:panel > 
                            <h:panelGrid columns="2" cellpadding="10px" cellspacing="15px">  

                                <h:outputText style="font-weight: bold" value="Title(*) " />
                                <p:inputText id="title" maxlength="100" style="width: 500px" value="#{propertyUserBean.property.proTitle}" required="true" requiredMessage="Required title field"/>

                                <h:outputText style="font-weight: bold" value="Content(*) " />
                                <h:panelGrid columns="1" cellpadding="3">
                                    <p:editor id="content" style="width: 500px" controls=""
                                              value="#{propertyUserBean.property.proContent}" 
                                              required="true" validatorMessage="Required content field" requiredMessage="Required content field">
                                        <f:validateLength minimum="5" />
                                    </p:editor>
                                </h:panelGrid>

                                <h:outputText value="Main image" />
                                <p:fileUpload value="#{propertyUserBean.fileMain}" mode="simple"
                                              allowTypes="/(\.|\/)(gif|jpe?g|png)$/"/>

                                <h:inputHidden />
                                <ui:fragment rendered="#{propertyUserBean.listImages.size()>0}" >
                                    <p:dataGrid columns="6" value="#{propertyUserBean.listImages}" var="image">  
                                        <p:graphicImage height="73" width="110" value="resources/upload/#{image}" />
                                    </p:dataGrid>
                                </ui:fragment>
                            </h:panelGrid>

                        </p:panel>
                        <p:spacer height="15px"/>
                        <p:fieldset legend="Basic information" toggleable="true" toggleSpeed="500" style="text-align: left;">  
                            <h:panelGrid columns="4" cellpadding="10px" cellspacing="15px">  


                                <h:outputText style="font-weight: bold" value="Type of property(*) " />
                                <p:selectOneMenu id="typOfProperty" style="width: 175px" value="#{propertyUserBean.property.propertyType.protId}" required="true" requiredMessage="Required type of property field" >  
                                    <f:selectItem itemLabel="--Select type--" itemValue="" />  
                                    <f:selectItems value="#{propertyTypeBean.propertyType}" var="prot" itemLabel="#{prot.protName}" itemValue="#{prot.protId}"/>  
                                </p:selectOneMenu>
                                <h:outputText style="font-weight: bold" value="Type of exchange(*) " />
                                <p:selectOneMenu id="typeOfExchange" style="width: 175px" value="#{propertyUserBean.property.exchangeType.exId}" required="true" requiredMessage="Required type of exchange field" >
                                    <f:selectItem itemLabel="Select exchange" itemValue="" />
                                    <f:selectItem itemLabel="For sale" itemValue="1" />
                                    <f:selectItem itemLabel="For rent" itemValue="2" />
                                </p:selectOneMenu>

                                <h:outputText style="font-weight: bold" value="Area(m2)(*) " />
                                <p:inputText value="#{propertyUserBean.property.proArea}" style="width: 168px" id="area" required="true" requiredMessage="Required area field" >
                                    <f:convertNumber type="number" />
                                    <p:ajax update="area"/>
                                </p:inputText>

                                <h:outputText style="font-weight: bold" value="Value(*) " />
                                <p:inputText value="#{propertyUserBean.property.proPrice}" style="width: 168px" id="txtValue" required="true" requiredMessage="Required value field" >
                                    <f:convertNumber type="currency"/>
                                    <p:ajax update="txtValue"/>
                                </p:inputText>

                                <h:outputText value="Negotiate " />
                                <p:selectBooleanCheckbox value="#{propertyUserBean.property.proNegotiate}" />

                                <h:outputText value="Direction: " />
                                <p:selectOneMenu id="txtDirection" style="width: 175px" value="#{propertyUserBean.property.proDirection}">  
                                    <f:selectItem itemLabel="--Select direction--" />  
                                    <f:selectItem itemLabel="East" itemValue="East"/>  
                                    <f:selectItem itemLabel="West" itemValue="West"/>  
                                    <f:selectItem itemLabel="North" itemValue="North"/>  
                                    <f:selectItem itemLabel="South" itemValue="South"/>  
                                </p:selectOneMenu>

                                <h:outputText value="Deposit " />
                                <p:inputText value="#{propertyUserBean.property.proDeposit}" style="width: 168px" id="txtDeposit" >
                                    <f:convertNumber type="currency"/>
                                    <p:ajax update="txtDeposit"/>
                                </p:inputText>

                                <h:outputText value="Num of bathrooms: " />
                                <p:selectOneMenu id="noOfBathrooms" style="width: 175px" value="#{propertyUserBean.property.proNoOfBathrooms}">  
                                    <f:selectItem itemLabel="--Select--" itemValue="" />  
                                    <f:selectItem itemLabel="1" itemValue="1"/>  
                                    <f:selectItem itemLabel="2" itemValue="2"/>  
                                    <f:selectItem itemLabel="3" itemValue="3"/>  
                                    <f:selectItem itemLabel="4" itemValue="4"/>  
                                    <f:selectItem itemLabel="5" itemValue="5"/>  
                                    <f:selectItem itemLabel="6" itemValue="6"/>  
                                    <f:selectItem itemLabel="7" itemValue="7"/>  
                                    <f:selectItem itemLabel="8" itemValue="8"/>  
                                    <f:selectItem itemLabel="9" itemValue="9"/>  
                                    <f:selectItem itemLabel="10" itemValue="10"/>
                                    <f:selectItem itemLabel="11" itemValue="11"/>  
                                    <f:selectItem itemLabel="12" itemValue="12"/>  
                                    <f:selectItem itemLabel="13" itemValue="13"/>  
                                    <f:selectItem itemLabel="14" itemValue="14"/>  
                                    <f:selectItem itemLabel="15" itemValue="15"/>  
                                </p:selectOneMenu>

                                <h:outputText value="Num of bedrooms: " />
                                <p:selectOneMenu id="txtnoOfBedrooms" style="width: 175px" value="#{propertyUserBean.property.proNoOfBebrooms}" >  
                                    <f:selectItem itemLabel="--Select--" itemValue="" />  
                                    <f:selectItem itemLabel="1" itemValue="1"/>  
                                    <f:selectItem itemLabel="2" itemValue="2"/>  
                                    <f:selectItem itemLabel="3" itemValue="3"/>  
                                    <f:selectItem itemLabel="4" itemValue="4"/>  
                                    <f:selectItem itemLabel="5" itemValue="5"/>  
                                    <f:selectItem itemLabel="6" itemValue="6"/>  
                                    <f:selectItem itemLabel="7" itemValue="7"/>  
                                    <f:selectItem itemLabel="8" itemValue="8"/>  
                                    <f:selectItem itemLabel="9" itemValue="9"/>  
                                    <f:selectItem itemLabel="10" itemValue="10"/>
                                </p:selectOneMenu>
                            </h:panelGrid>
                            <h:panelGrid columns="2" cellspacing="15px" style="font-size: 13px;">
                                <h:outputText value="Furniture " />
                                <p:inputTextarea id="txtFurniture" maxlength="2048" value="#{propertyUserBean.property.proFurniture}" rows="5" cols="80"/>
                            </h:panelGrid>
                        </p:fieldset>

                        <p:spacer height="15px"/>
                        <p:fieldset legend="Location information" toggleable="true" toggleSpeed="500" style="text-align: left;">  
                            <h:panelGrid columns="4" cellpadding="10" cellspacing="15px">  
                                <h:outputText value="Province" />
                                <p:selectOneMenu id="city" style="width: 175px" value="#{districtViewBean.provinceSelected}"  >  
                                    <f:selectItem itemLabel="Select City" itemValue="" />  
                                    <f:selectItems value="#{districtViewBean.listProvince}" var="prov" itemLabel="#{prov.provName}" itemValue="#{prov.provId}" />  
                                    <p:ajax update="txtDistrict" listener="#{districtViewBean.handleProvinceChange}" />  
                                </p:selectOneMenu>

                                <h:outputText style="font-weight: bold" value="District(*) " />
                                <p:selectOneMenu id="txtDistrict" style="width: 175px" value="#{propertyUserBean.property.district.distId}" required="true" requiredMessage="Required district field" >  
                                    <f:selectItem itemLabel="--Select district--" itemValue="" />  
                                    <f:selectItems value="#{districtViewBean.listDistrict}" var="dist" itemLabel="#{dist.distName}" itemValue="#{dist.distId}" />  
                                </p:selectOneMenu>

                                <h:outputText style="font-weight: bold" value="Address(*) " />
                                <p:inputText value="#{propertyUserBean.property.proAddress}" style="width: 168px" maxlength="50" id="txtAddress" required="true" requiredMessage="Required address field" />

                                <h:outputText value="Num of floor: " />
                                <p:selectOneMenu id="txtnoOfFloor" style="width: 175px" value="#{propertyUserBean.property.proNoOfFloors}" >  
                                    <f:selectItem itemLabel="--Select--" itemValue="" />  
                                    <f:selectItem itemLabel="1" itemValue="1"/>  
                                    <f:selectItem itemLabel="2" itemValue="2"/>  
                                    <f:selectItem itemLabel="3" itemValue="3"/>  
                                    <f:selectItem itemLabel="4" itemValue="4"/>  
                                    <f:selectItem itemLabel="5" itemValue="5"/>  
                                    <f:selectItem itemLabel="6" itemValue="6"/>  
                                    <f:selectItem itemLabel="7" itemValue="7"/>  
                                    <f:selectItem itemLabel="8" itemValue="8"/>  
                                    <f:selectItem itemLabel="9" itemValue="9"/>  
                                    <f:selectItem itemLabel="10" itemValue="10"/>
                                    <f:selectItem itemLabel="11" itemValue="11"/>  
                                    <f:selectItem itemLabel="12" itemValue="12"/>  
                                    <f:selectItem itemLabel="13" itemValue="13"/>  
                                    <f:selectItem itemLabel="14" itemValue="14"/>  
                                    <f:selectItem itemLabel="15" itemValue="15"/>  
                                </p:selectOneMenu>
                            </h:panelGrid>
                        </p:fieldset>
                        <p:spacer height="15px"/>
                        <p:fieldset legend="Contact information" toggleable="true" toggleSpeed="500" style="text-align: left;">  
                            <h:panelGrid columns="2" cellpadding="10" cellspacing="15px" style="vertical-align: top;">  
                                <h:outputText style="font-weight: bold" value="Contact Name(*) " />
                                <p:inputText value="#{propertyUserBean.property.proContactName}" style="width: 168px" maxlength="50" id="txtContactName" required="true" requiredMessage="Required contact name field" />
                                <h:outputText style="font-weight: bold" value="Telephone(*) " />
                                <p:inputText value="#{propertyUserBean.property.proContactPhone}" style="width: 168px" maxlength="20" id="txtContactTel" required="true" requiredMessage="Required contact phone field" />
                                <h:outputText value="Address: " />
                                <p:inputText value="#{propertyUserBean.property.proContactAddress}" style="width: 168px" maxlength="50" id="txtContactAddress" />

                            </h:panelGrid>
                        </p:fieldset>
                        <p:spacer height="15px"/>
                        <p:fieldset legend="Location" toggleable="true" toggleSpeed="500" style="text-align: left;">  
                            <h:panelGrid columns="3" cellpadding="10" cellspacing="15px" style="vertical-align: top;">  
                                <h:outputText value="Find address" />
                                <p:inputText id="findaddress" />
                                <p:commandButton value="Find" onclick="LayLatLng1();" />
                            </h:panelGrid>
                            <div id="gmap" style="width: 680px; height: 300px;"></div>
                            <h:inputHidden id="resultgmap" value="#{propertyUserBean.property.proPosition}" />
                        </p:fieldset>
                        <script type="text/javascript">
                            loadMapCp('admin', '', '', '');
                        </script>
                        <ui:fragment rendered="#{(param['id']!=null) and (propertyUserBean.property.proPosition!=null and propertyBean.property.proPosition != '') }">
                            <script type="text/javascript">
                                SetMap(#{propertyUserBean.property.lat}, #{propertyUserBean.property.lng}, 9);
                            </script>
                        </ui:fragment>

                        <p:spacer height="30px"/>
                        <h:inputHidden value="#{propertyUserBean.property.proId}" />
                        <h:inputHidden value="#{propertyUserBean.property.proStatus}" />
                        <h:inputHidden value="#{propertyUserBean.property.proHit}" />
                        <h:inputHidden value="#{propertyUserBean.property.proImage}" />
                        <h:inputHidden value="#{propertyUserBean.createDate}" />
                        <h:inputHidden value="#{propertyUserBean.createUser}" />
                        <h:inputHidden id="txtPublish" value="#{propertyUserBean.property.proPublish}" />


                        <p:commandButton  id="btnCreateEstate" value="Submit"
                                          oncomplete="handleRequest(xhr, status, args)" 
                                          ajax="false" update=":frm" actionListener="#{propertyUserBean.updateProperty}" > 
                        </p:commandButton>
                    </h:form>

                    <script type="text/javascript">
                        function handleRequest(xhr, status, args) {
                            if (!args.validationFailed || args.isAdd) {
                                location.href = args.url;
                            }
                        }
                    </script>
                </div>
            </ui:define>


        </ui:composition>

    </body>
</html>
